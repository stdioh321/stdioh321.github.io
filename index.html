<!DOCTYPE html>
<html ng-app="noSurf">
<!--
	API Key
	51cb531a971ca10554a6ae517b90efe6
	
	http://api.openweathermap.org/data/2.5/forecast/city?id=524901&APPID=&appid=51cb531a971ca10554a6ae517b90efe6
	

	http://api.openweathermap.org/data/2.5/forecast?lat=-23.43&lon=-45.07&appid=51cb531a971ca10554a6ae517b90efe6

	http://api.openweathermap.org/data/2.5/forecast?id={city ID}


	http://api.openweathermap.org/data/2.5/weather?lat=-23.4741297&lon=-46.3927326&appid=51cb531a971ca10554a6ae517b90efe6



	FORECAST.IO
	3633ce3ab311df404ee0fd9dc979541d
	https://api.forecast.io/forecast/APIKEY/LATITUDE,LONGITUDE
	https://api.forecast.io/forecast/3633ce3ab311df404ee0fd9dc979541d/37.8267,-122.423
-->
<head>
	<title>Teste</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="UTF-8" /> 
	<link rel="stylesheet" type="text/css" href="resources/lib/bootstrap/dist/css/bootstrap.css">
	
	<script type="text/javascript" src="resources/lib/angular/angular.js"></script>
	<script type="text/javascript" src="resources/lib/jquery/dist/jquery.js"></script>
	<script type="text/javascript" src="estados.js"></script>
	<script type="text/javascript" src="cidades.js"></script>
	<script type="text/javascript" src="praias.js"></script>
	
	<script type="text/javascript">

		var app = angular.module("noSurf", []);
		
		app.controller("noSurfCtrl", function($scope, $http){
				$scope.estados = estados;
				$scope.cidades = cidades;
				$scope.praias = praias;

				$scope.carregaCidade = function(tmpEstado){
					var tmp = false;
					if(tmpEstado != null){

						
						tmp = $scope.cidades.some(function(elem){
							if(elem.id_estado == tmpEstado.id){
								$scope.objCidades = elem.cidades;
								return true;
							}
						});
					}
					if(tmp == false){
						$scope.objCidades = {};
					}
				};

				$scope.carregaPraia = function(tmpCidade){
					var tmp = false;
					if(tmpCidade != null){
						tmp = $scope.praias.some(function(elem){
							if(elem.id_cidade == tmpCidade.id){
								$scope.objPraias = elem.praias;
								return true;
							}
						});
					}

					if(tmp == false){
						$scope.objPraias = {};
					}
				};

				$scope.carregaWeather = function(praia){
					console.log(praia);
					if(praia != null){
						$http({
							method: "GET",
							url: "http://api.openweathermap.org/data/2.5/weather?lat=" + praia.lat +"&lon=" + praia.lon +"&appid=51cb531a971ca10554a6ae517b90efe6"
						}).then(function(data){
							//console.log(data);
							$scope.result = data.data;

						},function(data){
							console.log("ERROR");
							console.log(data);
						});
					}
				};

		});
	</script>

</head>
<body ng-controller="noSurfCtrl">
	<div class="container-fluid">
			<div class="row">
				<div class="col-md-12">
					<ul class="list-group list-inline">
						<li class="list-group-item">
						
							<select class="form-control" ng-model="est" ng-options="item.name for item in estados" ng-change="carregaCidade(est)">
								<option value="">Selecione o Estado</option>
							</select>
						</li>
						<li class="list-group-item">
						
							<select class="form-control" ng-model="cid" ng-options="item.name for item in objCidades" ng-change="carregaPraia(cid)">
								<option value="">Selecione o Cidade</option>
							</select>
						</li>
						<li class="list-group-item">
						
							<select class="form-control" ng-model="pra" ng-options="item.name for item in objPraias" ng-change="carregaWeather(pra)">
								<option value="">Selecione o Praias</option>
							</select>
						</li>
					</ul>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<table class="table">
						<tr ng-repeat="(key,value) in result">
							<td>{{key | uppercase}}</td>
							<td>{{value}}</td>
						</tr>
					</table>
				</div>
			</div>
	</div>
</body>
</html>